## JVM学习笔记 内存结构
---
### 1. 程序计数器(PC Register)

&emsp;&emsp;记录下一条JVM指令的执行地址。使用寄存器来保存。

特点：

+ 线程私有
+ 不会存在内存溢出

---
### 2. 虚拟机栈(JVM Stacks)

&emsp;&emsp;线程运行需要的内存空间；由一个个栈帧组成，一个栈帧相当于一个方法调用。每一个线程运行时只有一个活动的栈帧。

重点：

+ 栈内存不是垃圾回收管理，调用完就没了。
+ 栈内存不是越大越好。
+ 栈变量看是否是多线程共享的变量，是共享的就不是线程安全的。
+ 栈溢出：
    1. 栈帧过多（例子：递归）
    2. 栈帧过大

调试|监控工具：

+ linux下 `jstack`就可以查看指定Pid的内存信息，可以定位到问题代码行数

案例：

1. 某个线程CPU占用过多
2. 程序运行很长时间没结果

---
### 3. 本地方法栈(Native Method Stacks)

&emsp;&emsp;不是java编写的方法称为本地方法。本地方法栈就是给本地方法提供内存空间。


---
### 4. 堆(Heap)

&emsp;&emsp;使用 `new` 关键字创建的对象存储在堆中。

特点：

+ 一般线程不安全的
+ 有垃圾回收机制
+ 堆溢出：
    1. 不断创建对象，对象的引用未解除，没有被垃圾回收

堆诊断：

1. jps工具：查看当前系统中有哪些java进程
2. `jmap -heap 进程号`工具：查看堆内存占用情况
3. jconsole工具：图形界面，多功能检测工具，可以连续检测
4. jvisualvm工具：JVM可视化工具

---
### 5. 方法区（Method Area）

线程共享的一个区域



---

#### [返回目录](./)

