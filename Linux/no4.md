## Linux学习笔记 文件权限管理 
---
### 1. 文件属性

&emsp;&emsp;如下形式是一个文件的属性，可以通过`ls -l`或者`ll`来查看（关于ls命令在文件与目录管理的笔记 中会有写到）：  
```
-rw-------. 1 root root 1235 8月  11 14:40 anaconda-ks.cfg
[1]        [2] [3]  [4]  [5]    [6]             [7]
```

1. 文件的类型和权限  
第一个字符表示文件的类型，可以是如下字符：  
    ```
    d :表示目录
    - :表示文件
    l :表示链接文件
    b :表示随机读写设备，块级设备
    c :表示串口设备，字符设备
    s :表示数据接口文件，比如socket
    p :表示FIFO文件，管道
    ```  
    接下来的9个字符分为三组，且一般情况下都是[`rwx`]三个参数的组合，`r`代表可读，`w`代表可写，`x`代表可执行，如果没有权限就是`-`。  
    第一组是文件所有者的权限。  
    第二组是用户组的权限。  
    第三组是其他用户的权限。

2. 节点数目  
表示有多少文件名链接到此节点。

3. 所有者  
表示文件或目录的所有者用户。

4. 用户组  
表示文件所属的用户组。

5. 文件大小  
表示文件的容量大小，单位Bytes，字节。

6. 最后修改时间  
表示文件的最后修改时间。

7. 文件名  
表示文件的名称，如果文件名前有一个 `.` ，则表示这个文件为隐藏文件。需要 `ls -a` 才能显示。  

---
### 2. 权限的具体说明

&emsp;&emsp;linux把所有设备都当作文件，目录也是一个文件。而文件本身只包括自身内部的内容，比如：文件名以及相关属性不属于文件本身的内容，文件名是拥有它的目录的内容。

1. 对于文件（只针对文件自身内部的内容）  
    + r 权限 : 可以读取此文件的实际内容（文件自身内部的内容）
    + w 权限 : 可以修改文件内容
    + x 权限 : 可以被执行

2. 对于目录（目录当作一个记录文件信息的文件）  
    + r 权限 : 仅仅能够读取这个目录的信息（既文件名列表）
    + w 权限 : 可以修改目录的内容（既对子文件或目录进行增、删、改名、移动）
    + x 权限 : 可以进入该目录成为工作目录（如果没有此权限，就算目录中文件有所有权限也没法操作文件）  
    **注：一般来说目录的 r权限 和 x权限都是一起给的**

3. 三个特殊权限
    + **SUID 权限** : 当文件所有者权限的 `x` 位置是 `s` 时，称为SUID权限。主要用于化身成对应所有者用户，安全的操作敏感文件。
        + 仅用于二进制文件（不包括shell脚本）
        + 执行者需要具有 `x` 权限
        + 二进制文件执行**过程中**将具有文件所有者的权限，且只在运行过程中有效
        + 如果文件所有者也没有 `x` 权限，那么使用大写 `S` 占位，表示空
    + **SGID 权限** : 当用户组权限的 `x` 位置是 `s` 时，称为SGID权限。主要用于化身成对于用户组，可以用于目录。
        + 即可是二进制文件也可以是目录
        + 执行者需要具有 `x` 权限，目录则还应该具有 `r` 权限
        + 程序执行过程中获得文件所在用户组的权限
        + 如果是目录，执行者在该目录下的用户组变为目录的用户组
        + 如果文件或目录的用户组权限不具有 `x` 权限，那么使用大写 `S` 占位，表示空
    + **SBIT 权限** : 当其他权限的 `x` 位置是 `t` 时，成为SBIT权限。主要用于保护公共目录下各个用户私有文件的安全。
        + 仅用于目录
        + 当前用户在该目录下创建的文件，仅有自己和root可以删除、更名和移动操作此文件（既该目录的w权限只用于自己创建文件上）
        + 如果目录的其它权限不具有 `x`，那么使用大写 `T` 占位，代表空

---
### 3.权限相关命令

1. 查看和修改默认权限  
使用一下命令可以查看当前用户的默认权限：
    ```
    # umask
    0022
    # umask -S
    u=rwx, g=rx, o=rx
    ```
    第一种方式显示的四个数字分别代表 三个特殊权限（sst分别对应421，在这里没用作用）、所用者用户权限、用户组权限、其他权限（rwx分别对应421）**相对于默认值需要拿掉的权限**。  
    1). 文件的默认值是：`0666` 既是 `-rw-rw-rw-`  
    2). 目录的默认值是：`0777` 既是 `drwxrwxrwx`  

    第二种方式显示的是代表对应默认应该具有的权限。

    使用一下命令可以设置当前的默认权限（仅本次登陆）：
    ```
    # umask 002
    ```
    注意：不能设置三个特殊权限的默认值，他们的默认值都是0。  
    全局默认值的配置在/etc/bashrc里，用户的在~/.bashrc里也有配置。  

2. 修改用户组  
使用如下命令可以修改文件或目录的用户组：
    ```
    # chgrp [-cfhRv] [所属群组] [文件或目录...] 

    # chgrp [-cfhRv] [--reference=<参考文件或目录>] [文件或目录...]
    ```
    参数说明：
    + -c ： 效果类似"-v"参数，但仅回报更改的部分
    + -f ： 不显示错误信息
    + -h ： 只对符号连接的文件作修改，而不更动其他任何相关文件
    + -R ： 递归处理，将指定目录下的所有文件及子目录一并处理
    + -v ： 显示指令执行过程
    + --reference=<参考文件或目录> ： 把指定文件或目录的所属群组全部设成和参考文件或目录的所属群组相同

3. 修改所有者用户
使用如下命令可以修改文件或目录的所有者用户：
    ```
    chown [-cfhvR] [user][:group] file...
    ```
    参数说明：
    + user ： 新的文件拥有者的使用者 ID
    + group ： 新的文件拥有者的使用者组(group)
    + -c ： 显示更改的部分的信息
    + -f ： 忽略错误信息
    + -h ： 修复符号链接
    + -v ： 显示详细的处理信息
    + -R ： 处理指定目录以及其子目录下的所有文件

4. 修改权限
使用如下命令可以修改文件或目录的权限：
    ```
    chmod [-cfvR] [mode] file...
    ```
    参数说明：
    + mode ： 权限设定字串
    + -c ： 若该文件权限确实已经更改，才显示其更改动作
    + -f ： 若该文件权限无法被更改也不要显示错误讯息
    + -v ： 显示权限变更的详细资料
    + -R ： 对目前目录下的所有文件与子目录进行相同的权限变更(即以递回的方式逐个变更)  
    
    其中mode参数格式如下：
    ```
    [ugoa...][[+-=][rwxst]...][,...]

    或者

    4或3位数字，分别代表三个特殊权限（sst分别对应421）、所用者用户权限、用户组权限、其他权限（rwx分别对应421）
    ```
    其中：
    + `u` 表示该文件的拥有者，`g` 表示与该文件的拥有者属于同一个群体(group)者，`o` 表示其他以外的人，`a` 表示这三者皆是
    + `+` 表示增加权限、`-` 表示取消权限、`=` 表示唯一设定权限
    + `r` 表示可读取，`w` 表示可写入，`x` 表示可执行，`s` 表示suid货sgid，`t` 表示sbit

---
#### [返回目录](./)